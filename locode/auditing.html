<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name='date' content='2023-07-02T14:43:16.2064426Z'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/svg" href="/img/logo.svg">
    <title>Auditing</title>
    <script>
    const cls = document.querySelector('html').classList
    if (localStorage.getItem('color-scheme') === 'dark')
        cls.add('dark')
    else
        cls.remove('dark')
    </script>
    <link rel="stylesheet" href="/css/app.css">
    

    <script async src="https://ga.jspm.io/npm:es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
{
    "imports": {
        "app.mjs": "/mjs/app.mjs",
        "vue": "/lib/mjs/vue.min.mjs",
        "@servicestack/client": "/lib/mjs/servicestack-client.min.mjs",
        "@servicestack/vue": "/lib/mjs/servicestack-vue.min.mjs"
    }
}
</script>
</head>
<body class="bg-white dark:bg-black dark:text-white">
<header class="top-0 fixed z-50 h-14 bg-white dark:bg-black opacity-90 w-full shadow">
    <div class="flex flex-wrap items-center max-w-[100rem] mx-auto">
        <div class="absolute z-10 top-2 left-2 sm:static flex-shrink flex-grow-0">
            <div class="cursor-pointer">
                <a class="navbar-brand flex items-center" href="/">
                    <svg class="w-8 h-8 sm:ml-2 sm:w-12 sm:h-12" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="currentColor" d="M10 6c1.544 1.76 2.276 4.15 2.217 6.61c3.968 1.67 9.924 6.12 11.181 12.39H28C26.051 14.31 14.918 6.77 10 6zm-2 7c4.67 4.913.81 11.582-4 12h18.97C21.5 18.289 11.95 13.533 8 13z"/></svg>
                    <span class="hidden sm:block text-2xl font-semibold">Documentation</span>
                </a>
            </div>
        </div>
        <div class="flex flex-grow flex-shrink flex-nowrap justify-end items-center">
            <nav class="relative flex flex-grow leading-6 font-semibold text-slate-700 dark:text-slate-200">
                <ul class="flex flex-wrap items-center justify-end w-full m-0 pb-2 sm:pb-0">
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="/templates/" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    Project Templates
                                </a>
                            </li>
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="/vue/" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    Vue
                                </a>
                            </li>
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="/autoquery/" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    AutoQuery
                                </a>
                            </li>
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="/locode/" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400 text-blue-700 dark:text-blue-300">
                                    Locode
                                </a>
                            </li>
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="/auth/" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    Security
                                </a>
                            </li>
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="/grpc/" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    gRPC
                                </a>
                            </li>
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="/ormlite/" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    OrmLite
                                </a>
                            </li>
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="/redis/" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    Redis
                                </a>
                            </li>
                    <li class="relative flex flex-wrap just-fu-start m-0">
                        <div data-component="DarkModeToggle" class="ml-2 w-10"></div>
                    </li>
                </ul>
            </nav>

        </div>
    </div>
</header>
<script type="module">
import { mountAll } from "app.mjs"
mountAll()
</script>


<div class="min-h-screen">
    <main role="main" class="pt-14 pb-3 max-w-[100rem] mx-auto">
        



<style>
</style>
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/typography.css">
<link rel="stylesheet" href="/css/lite-yt-embed.css">

<div class="w-full max-w-[100rem] mx-auto">
    <div class="flex flex-wrap">
        <div class="hidden xl:block z-40 inset-0 flex-none bg-white dark:bg-black lg:w-64 xl:w-80">
            <div class="fixed h-screen overflow-y-auto scrolling-touch overflow-hidden">
                <nav class="sidebar bg-white dark:bg-black lg:w-64 xl:w-80 px-1 pt-6 pb-16 overflow-y-auto font-medium text-base sm:px-3 xl:px-5 lg:text-sm" aria-label="Sidebar">
                                <a href="/locode/" class="block flex items-center whitespace-nowrap">
<svg class='h-6 w-6 shrink-0 text-sky-500' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' aria-hidden='true'><path stroke-linecap='round' stroke-linejoin='round' d='M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25'></path></svg>                                    <span class="p-2 pl-3 font-display font-medium text-slate-900 dark:text-white">
Locode                                    </span>
                                </a>
                        <ul role="list" class="mb-6 mt-2 ml-3 space-y-2 border-l-2 border-slate-100 dark:border-slate-800 lg:mt-4 lg:space-y-4 lg:border-slate-200">
                                <li class="relative">
                                    <a href="/locode/database-first" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Database-First
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/code-first" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Code-First
                                    </a>
                                </li>
                        </ul>
                                <h2 class="font-display font-medium text-slate-900 dark:text-white whitespace-nowrap">
                                    C# Development Model
                                </h2>
                        <ul role="list" class="mb-6 mt-2 ml-3 space-y-2 border-l-2 border-slate-100 dark:border-slate-800 lg:mt-4 lg:space-y-4 lg:border-slate-200">
                                <li class="relative">
                                    <a href="/locode/declarative" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Declarative Attributes
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/programmatic" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Code Customizations
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/branding" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Branding &amp; Appearance
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/formatters" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Format Functions
                                    </a>
                                </li>
                        </ul>
                                <h2 class="font-display font-medium text-slate-900 dark:text-white whitespace-nowrap">
                                    Custom HTML/JS
                                </h2>
                        <ul role="list" class="mb-6 mt-2 ml-3 space-y-2 border-l-2 border-slate-100 dark:border-slate-800 lg:mt-4 lg:space-y-4 lg:border-slate-200">
                                <li class="relative">
                                    <a href="/locode/custom-overview" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Overview
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/custom-autoquerygrid" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Custom AutoQueryGrid
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/custom-forms" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Custom Forms
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/custom-components" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Custom Components
                                    </a>
                                </li>
                        </ul>
                                <h2 class="font-display font-medium text-slate-900 dark:text-white whitespace-nowrap">
                                    File Management
                                </h2>
                        <ul role="list" class="mb-6 mt-2 ml-3 space-y-2 border-l-2 border-slate-100 dark:border-slate-800 lg:mt-4 lg:space-y-4 lg:border-slate-200">
                                <li class="relative">
                                    <a href="/locode/files-overview" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Overview
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/files-blazor" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        File Blazor Demo
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/files-upload-filesystem" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        File System
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/files-upload-aws" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        AWS
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/files-upload-azure" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Azure
                                    </a>
                                </li>
                        </ul>
                                <h2 class="font-display font-medium text-slate-900 dark:text-white whitespace-nowrap">
                                    Features
                                </h2>
                        <ul role="list" class="mb-6 mt-2 ml-3 space-y-2 border-l-2 border-slate-100 dark:border-slate-800 lg:mt-4 lg:space-y-4 lg:border-slate-200">
                                <li class="relative">
                                    <a href="/locode/auditing" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full active font-semibold text-sky-500 before:bg-sky-500">
                                        Auditing
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/locode/advanced" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Advanced
                                    </a>
                                </li>
                        </ul>
                </nav>
            </div>
        </div>
        <div id="doc" class="mx-auto flex">
            <div class="mt-8 mx-auto prose lg:prose-lg" style="width:var(--content-width)">
                
                    <section class="not-prose mb-16 md:mb-12">
                        <h1 class="text-4xl tracking-tight font-extrabold text-gray-900 dark:text-gray-50 sm:text-5xl md:text-6xl">
                            Auditing
                        </h1>
                    </section>

                <div class="not-prose"></div>

                <p>A benefit to AutoQuery's structured declarative approach to its CRUD APIs is that it's better able to enable high-level
generic functionality that can benefit all CRUD APIs. AutoQuery CRUD's
<a href="/autoquery/audit-log">Executable Audit Log</a> is an example of this which makes use of
<a href="/autoquery/crud#autoquery-crud-attributes">AutoQuery CRUD Attributes</a>
to capture every CRUD operation responsible for any modifications to its underlying RDBMS tables.</p>
<p>We'll explore an overview of this feature by applying it to our simple Bookings table from the
<a href="/autoquery/crud-bookings">AutoQuery CRUD Bookings Demo</a> included in all
<a href="https://jamstacks.net/">jamstacks.net</a> project templates there by adding the ability to track all CRUD API operations
and with it all modifications made to our <code>Booking</code> RDBMS table.</p>
<h2 id="enabling-crud-events">Enabling Crud Events<a class="header-anchor" href="javascript:;" onclick="location.hash='#enabling-crud-events'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>First thing we need to do is register the <code>ICrudEvents</code> dependency in our App's IOC, in this case uses <code>OrmLiteCrudEvents</code>
to store all Audit Information in the <code>CrudEvent</code> table of our configured database:</p>
<pre><code class="language-csharp">public class ConfigureAutoQuery : IHostingStartup
{
    public void Configure(IWebHostBuilder builder) =&gt; builder
        .ConfigureServices(services =&gt; {
            // Enable Audit History
            services.AddSingleton&lt;ICrudEvents&gt;(c =&gt;
                new OrmLiteCrudEvents(c.Resolve&lt;IDbConnectionFactory&gt;()));
        })
        .ConfigureAppHost(appHost =&gt; {
            appHost.Plugins.Add(new AutoQueryFeature {
                MaxLimit = 1000,
                //IncludeTotal = true,
            });
            
            // Create CrudEvent if it doesn't exist
            appHost.Resolve&lt;ICrudEvents&gt;().InitSchema();
        });
}
</code></pre>
<p>As <code>ICrudEvents</code> stores all events in a separate table, we also need to use <code>InitSchema</code> above to create the <code>CrudEvent</code>
table if it doesn't already exist.</p>
<h2 id="enabling-audit-history-tracking-on-data-models-and-apis">Enabling Audit History Tracking on Data Models and APIs<a class="header-anchor" href="javascript:;" onclick="location.hash='#enabling-audit-history-tracking-on-data-models-and-apis'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>With <code>ICrudEvents</code> registered, we can now choose which Data Models we want to enable Audit Tracking on by having them
inherit from the built-in <code>AuditBase</code> class:</p>
<pre><code class="language-csharp">public class Booking : AuditBase
{
    [AutoIncrement]
    public int Id { get; set; }
    public string Name { get; set; }
    public RoomType RoomType { get; set; }
    public int RoomNumber { get; set; }
    public DateTime BookingStartDate { get; set; }
    public DateTime? BookingEndDate { get; set; }
    public decimal Cost { get; set; }
    public string Notes { get; set; }
    public bool? Cancelled { get; set; }
}
</code></pre>
<p>This will extend our RDBMS tables with additional Audit Info to capture who and when bookings were <strong>Created</strong>,
<strong>Last Modified</strong> and <strong>Deleted</strong> (when using Soft Deletes):</p>
<pre><code class="language-csharp">public abstract class AuditBase
{
    public DateTime CreatedDate { get; set; }
    public string CreatedBy { get; set; }
    public DateTime ModifiedDate { get; set; }
    public string ModifiedBy { get; set; }
    public DateTime? DeletedDate { get; set; }
    public string DeletedBy { get; set; }
}
</code></pre>
<p>Even without needing to inspect the audit history table, capturing this info on its own provides valuable insight into
the provenance of each booking.</p>
<h3 id="configuring-crud-apis">Configuring CRUD APIs<a class="header-anchor" href="javascript:;" onclick="location.hash='#configuring-crud-apis'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>But to be able to maintain a complete executable audit log we need to capture every CRUD API and modification done on
our <code>Booking</code> table which we can do by annotating our Booking CRUD APIs with
<a href="/autoquery/crud#apply-generic-crud-behaviors">AutoApply</a> attribute which annotates our
APIs with the behavior we want to apply to them.</p>
<p>For the Audit feature, this behavior is implemented in the pre-registered
<a href="/autoquery/crud#auditautocrudmetadatafilter">AuditAutoCrudMetadataFilter</a> which dynamically
adds attributes to annotated APIs to achieve it's desired behavior. By primarily using the
<a href="/autoquery/crud#autopopulate">[AutoPopulate]</a> attribute to populate the Audit Info and
<a href="/autoquery/crud#autofilter">[AutoFilter]</a> attribute to ensure our Query APIs don't
return any <strong>Soft Deleted</strong> records.</p>
<p>Essentially <code>[AutoApply]</code> enables us to define a single attribute as a substitute for defining the multiple compound attributes
to populate the Audit Info and Filter queries.</p>
<p>The appropriate <code>[AutoApply]</code> behavior needs to be added on all the CRUD APIs for the data models we want Audit History
tracking enabled on, e.g:</p>
<pre><code class="language-csharp">[AutoApply(Behavior.AuditQuery)]
public class QueryBookings : QueryDb&lt;Booking&gt;
{
    //...
}

[AutoApply(Behavior.AuditCreate)]
public class CreateBooking
    : ICreateDb&lt;Booking&gt;, IReturn&lt;IdResponse&gt;
{
    //...
}

[AutoApply(Behavior.AuditModify)]
public class UpdateBooking
    : IPatchDb&lt;Booking&gt;, IReturn&lt;IdResponse&gt;
{
    //...
}

[AutoApply(Behavior.AuditSoftDelete)]
public class DeleteBooking : IDeleteDb&lt;Booking&gt;, IReturnVoid
{
    //...
}
</code></pre>
<div class="tip custom-block">
                <p class="custom-block-title">TIP</p><p>Use <code>Behavior.AuditDelete</code> instead if you prefer your delete operations resulted in permanent hard deletes</p>
</div>
<h2 id="audit-info-in-locode">Audit Info in Locode<a class="header-anchor" href="javascript:;" onclick="location.hash='#audit-info-in-locode'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>The <code>AutoQueryFeature.AccessRole</code> determines the accessibility of the CRUD Event APIs that Locode uses to display the
Audit History logs for each entity, which by default is restricted to <strong>Admin</strong> users who will be able to view the
Audit History of each record at the bottom of its <strong>Edit</strong> Form.</p>
<p>With our Bookings CRUD APIs now configured with Audit behavior we can see an example of what this looks like in Locode
after the Employee User account records a Booking from <strong>John Smith</strong> for a <strong>Single</strong> room:</p>
<p><img src="/img/pages/locode/audit-history-create.png" alt="" /></p>
<p>With the left section displaying audit information about the CRUD operation and the User making it including their
UserName, Id and IP. The right section contains the info sent in the Request DTO, in this case the <code>CreateBooking</code> API.</p>
<p>If <strong>John Smith</strong> later contacts the manager to upgrade his booking to a <strong>Suite</strong>, the Audit information will be updated
with the <code>UpdateBooking</code> Audit entry which as it is a <code>IPatchDb&lt;Table&gt;</code> operation, only contains information that's <strong>changed</strong>:</p>
<p><img src="/img/pages/locode/audit-history-update.png" alt="" /></p>
<p>This is typically why the behavior of <code>IPatchDb&lt;Table&gt;</code> is preferable over <code>IUpdateDb&lt;Table&gt;</code> APIs when Audit Tracking
is enabled as otherwise each Update operation would instead contain the entire entry on each update.</p>
<h2 id="full-executable-audit-history">Full Executable Audit History<a class="header-anchor" href="javascript:;" onclick="location.hash='#full-executable-audit-history'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>As each Audit Entry contains the CRUD Request DTO, they can be used to recreate the state of the database by replaying
each event &amp; executing them against a blank database:</p>
<pre><code class="language-csharp">var eventsPlayer = new CrudEventsExecutor(appHost);
foreach (var crudEvent in dbEvents.GetEvents(db))
{
    await eventsPlayer.ExecuteAsync(crudEvent);
}
</code></pre>
<p>This can provide similar benefits to <a href="https://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a> without its
additional development &amp; maintenance burden where they can be used to reconstruct the state of the database at a specific
point in time or used to populate external data stores like search indexes or analytical reporting databases to enable
greater insight than what an RDBMS snapshot can provide.</p>
<p>You could replay all events to reconstruct the entire state of the database, or choose just the tables you want to
rebuild where you can fetch all Audit Events for just the <code>Booking</code> table with:</p>
<pre><code class="language-csharp">var bookingAuditEvents = dbEvents.GetEvents(Db, nameof(Booking));
</code></pre>
<p>Alternatively you can fetch all the audit events for a single row which is what Locode uses to display its Audit Events:</p>
<pre><code class="language-csharp">var rowAuditEvents = dbEvents.GetEvents(Db, nameof(Booking), id);
</code></pre>
<h2 id="complete-bookings-crud-implementation">Complete Bookings CRUD Implementation<a class="header-anchor" href="javascript:;" onclick="location.hash='#complete-bookings-crud-implementation'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>The <a href="/autoquery/crud-bookings">Bookings CRUD Demo</a> is a good representative example of the
effort it takes to implement a traditional CRUD API with AutoQuery:</p>
<p><lite-youtube class="w-full mx-4 my-4" width="560" height="315" videoid="rSFiikDjGos" style="background-image: url('https://img.youtube.com/vi/rSFiikDjGos/maxresdefault.jpg')"></lite-youtube></p>
<p>Which reduces the development to effort of creating Full Stack Apps down to declaring your Data Models and APIs with
simple POCOs to define the precise schema of the underlying RDBMS tables and API contract, that can then benefit from:</p>
<ul>
<li>Productive end-to-end <a href="https://servicestack.net/service-reference">typed Development Model in 9 languages</a></li>
<li><a href="/locode/declarative">Declarative Dev Model</a> for defining Authentication, Validation, Documentation &amp; UI Customizations</li>
<li>Beautiful, UX-Friendly, capability-based Customizable UI in <a href="https://www.locode.dev">Locode</a></li>
<li>Rich analysis, API discoverability &amp; <a href="/api-explorer#code-tab">simplified client integrations</a> in <a href="/api-explorer">API Explorer</a></li>
<li>Powerful querying capabilities in <a href="/autoquery/">AutoQuery</a></li>
<li>Full executable <a href="/autoquery/audit-log">Audit History Tracking</a></li>
<li>Access to ServiceStack's rich ecosystem of <a href="/why-servicestack#multiple-clients">typed clients, versatile formats &amp; endpoints</a></li>
<li>Seamless integrations with <a href="/openapi">Open API</a>, interactive <a href="/jupyter-notebooks">Jupyter Notebooks</a> &amp; <a href="https://apps.servicestack.net/">Instant Client Apps</a></li>
</ul>
<p>And access to ServiceStack's rich ecosystem of features, most of which are centered around your typed API contracts
making them easy to enhance &amp; apply to your existing Services.</p>
<p>All without needing to write a single line of implementation logic thanks to the default implementation in AutoQuery
Services &amp; Auto UIs in Locode, API Explorer &amp; Swagger UI. At the same time when needed the default behavior
can be overridden at multiple levels, from custom AutoQuery implementations on the server to custom UIs on the client.</p>
<p>For completeness, the entire source code used to implement the Bookings CRUD implementation is below:</p>
<pre><code class="language-csharp">public class Booking : AuditBase
{
    [AutoIncrement]
    public int Id { get; set; }
    public string Name { get; set; }
    public RoomType RoomType { get; set; }
    public int RoomNumber { get; set; }
    public DateTime BookingStartDate { get; set; }
    public DateTime? BookingEndDate { get; set; }
    public decimal Cost { get; set; }
    public string Notes { get; set; }
    public bool? Cancelled { get; set; }
}

public enum RoomType
{
    Single,
    Double,
    Queen,
    Twin,
    Suite,
}

[AutoApply(Behavior.AuditQuery)]
public class QueryBookings : QueryDb&lt;Booking&gt;
{
    public int[] Ids { get; set; }
}

[ValidateHasRole(&quot;Employee&quot;)]
[AutoApply(Behavior.AuditCreate)]
public class CreateBooking
    : ICreateDb&lt;Booking&gt;, IReturn&lt;IdResponse&gt;
{
    public string Name { get; set; }
    public RoomType RoomType { get; set; }
    [ValidateGreaterThan(0)]
    public int RoomNumber { get; set; }
    public DateTime BookingStartDate { get; set; }
    public DateTime? BookingEndDate { get; set; }
    [ValidateGreaterThan(0)]
    public decimal Cost { get; set; }
    public string Notes { get; set; }
}

[ValidateHasRole(&quot;Employee&quot;)]
[AutoApply(Behavior.AuditModify)]
public class UpdateBooking
    : IPatchDb&lt;Booking&gt;, IReturn&lt;IdResponse&gt;
{
    public int Id { get; set; }
    public string Name { get; set; }
    public RoomType? RoomType { get; set; }
    [ValidateGreaterThan(0)]
    public int? RoomNumber { get; set; }
    public DateTime? BookingStartDate { get; set; }
    public DateTime? BookingEndDate { get; set; }
    [ValidateGreaterThan(0)]
    public decimal? Cost { get; set; }
    public bool? Cancelled { get; set; }
    public string Notes { get; set; }
}

[ValidateHasRole(&quot;Manager&quot;)]
[AutoApply(Behavior.AuditSoftDelete)]
public class DeleteBooking : IDeleteDb&lt;Booking&gt;, IReturnVoid
{
    public int Id { get; set; }
}
</code></pre>


                <div class="not-prose"></div>

                    <div class="not-prose my-20">
                                <nav class="flex items-center justify-between border-t border-gray-200 dark:border-gray-700 px-4 sm:px-0">
                                    <div class="-mt-px flex w-0 flex-1">
                                            <a href="/locode/files-upload-azure" class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-gray-500 hover:border-gray-300 dark:hover:border-gray-600 hover:text-gray-700 dark:hover:text-gray-200">
                                                <!-- Heroicon name: mini/arrow-long-left -->
                                                <svg class="mr-3 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                    <path fill-rule="evenodd" d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z" clip-rule="evenodd"></path>
                                                </svg>
                                                Azure
                                            </a>
                                    </div>
                                    <div class="hidden md:-mt-px md:flex"></div>
                                    <div class="-mt-px flex w-0 flex-1 justify-end">
                                            <a href="/locode/advanced" class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-gray-500 hover:border-gray-300 dark:hover:border-gray-600 hover:text-gray-700 dark:hover:text-gray-200">
                                                Advanced
                                                <!-- Heroicon name: mini/arrow-long-right -->
                                                <svg class="ml-3 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                    <path fill-rule="evenodd" d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z" clip-rule="evenodd"></path>
                                                </svg>
                                            </a>
                                    </div>
                                </nav>
                    </div>
            </div>
                
                <div class="docmap hidden 2xl:block flex-none w-64 pl-8 mr-8">
                    <div class="fixed bg-white dark:bg-black flex flex-col overflow-y-auto pt-10 px-8 pb-6" style="height:calc(100vh - 50px);">
                        <div>
                            <h5 class="text-slate-900 font-semibold mb-4 text-sm leading-6 dark:text-slate-100">
                                On This Page
                            </h5>
                            <ul class="text-slate-700 text-sm leading-6">
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#enabling-crud-events'" data-id="enabling-crud-events" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Enabling Crud Events
                                        </span>
                                    </li>
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#enabling-audit-history-tracking-on-data-models-and-apis'" data-id="enabling-audit-history-tracking-on-data-models-and-apis" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Enabling Audit History Tracking on Data Models and APIs
                                        </span>
                                            <ul class="ml-4">
                                                    <li data-id="configuring-crud-apis" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#configuring-crud-apis'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            Configuring CRUD APIs
                                                        </span>
                                                    </li>
                                            </ul>
                                    </li>
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#audit-info-in-locode'" data-id="audit-info-in-locode" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Audit Info in Locode
                                        </span>
                                    </li>
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#full-executable-audit-history'" data-id="full-executable-audit-history" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Full Executable Audit History
                                        </span>
                                    </li>
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#complete-bookings-crud-implementation'" data-id="complete-bookings-crud-implementation" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Complete Bookings CRUD Implementation
                                        </span>
                                    </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
        </div>
    </div>    
</div>

<script>
//doc instructions
if (document.querySelector('.hide-title')) {
    const el = document.querySelector('#doc section h1') 
    if (el) el.style.display='none'
}
</script>

<script type="module">
import { mount } from "app.mjs"


    const App = {
        setup() {
            function nav(url) {
                window.open(url)
            }
            return { nav }
        }
    }
    
mount('#doc', App)
</script>

<script src="/lib/js/highlight.js"></script>
<script>hljs.highlightAll()</script>
<script src="/lib/js/lite-yt-embed.js"></script>
<script src="/js/custom.js"></script>

<style>
.active {
    color: #0ea5e9 !important;
}
</style>
<script type="module">
import { $$, $1, on, leftPart, map } from "@servicestack/client"
//change #hash on scroll
const headings = $$('h2[id],h3[id]')

function select(id) {
    $$(`.docmap .active`).forEach(el => el.classList.remove('active'))
    map($1(`.docmap [data-id='${id}']`), el => {
        el.classList.add('active')
        map(el.closest('.group'), el => el.classList.add('active'))
    })
}

on(document, {
    scroll(e) {
        headings.forEach(ha => {
            const rect = ha.getBoundingClientRect()
            if (rect.top > 0 && rect.top < 150) {
                const location = leftPart(window.location.toString(), '#')
                history.replaceState(null, null, location + '#' + ha.id)
                select(ha.id)
            }
        })
    }
})
if (location.hash) {
    select(location.hash.substring(1))
}

//scroll menu item into view
function isInView(el) {
  const box = el.getBoundingClientRect();
  return box.top < window.innerHeight && box.bottom >= 0;
}

const active = $1('.sidebar .active')
if (active && !isInView(active)) {
    (active.parentElement.previousElementSibling || active.parentElement.parentElement || active).scrollIntoView()
}
</script>


    </main>
</div>

<script type="module">
import { init } from "app.mjs"
init()
</script>





</body>
</html>