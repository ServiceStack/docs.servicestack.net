<!doctype html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-7722718-13"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date()); gtag('config', 'UA-7722718-13');</script>
    
    <meta charset="utf-8"/>
    <meta name='date' content='2025-11-13T16:00:47.8080665Z'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/svg" href="/img/logo.svg">
    <title>Auth Repository</title>
    <script>
    if (location.search === "?dark") localStorage.setItem('color-scheme','dark') 
    if (location.search === "?light") localStorage.removeItem('color-scheme') 
    const cls = document.querySelector('html').classList
    if (localStorage.getItem('color-scheme') === 'dark')
        cls.add('dark')
    else
        cls.remove('dark')
    </script>
    <style>html { scroll-padding-top: 5rem }</style>
    <link rel="stylesheet" href="/css/app.css">
    
    <script type="importmap">
{
    "imports": {
        "app.mjs": "/mjs/app.mjs",
        "vue": "/lib/mjs/vue.mjs",
        "@servicestack/client": "/lib/mjs/servicestack-client.mjs",
        "@servicestack/vue": "/lib/mjs/servicestack-vue.mjs",
        "marked": "/lib/mjs/marked.min.mjs",
        "highlight.js": "/lib/mjs/highlight.min.mjs"
    }
}
</script>
</head>
<body class="bg-white dark:bg-black dark:text-white">

<header id="header" class="top-0 fixed z-50 h-14 bg-white/90 dark:bg-black/90 w-full shadow">
  <nav class="border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-black">
    <div class="mx-auto max-w-[100rem] pr-4 sm:pr-6 lg:pr-8">
      <div class="flex h-16 justify-between">
        <div class="flex">
          <div class="flex flex-shrink-0 items-center">
            <a class="mr-2 lg:mr-8 flex items-center" href="/">
                <svg class="w-8 h-8 sm:ml-2 sm:w-12 sm:h-12" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="currentColor" d="M10 6c1.544 1.76 2.276 4.15 2.217 6.61c3.968 1.67 9.924 6.12 11.181 12.39H28C26.051 14.31 14.918 6.77 10 6zm-2 7c4.67 4.913.81 11.582-4 12h18.97C21.5 18.289 11.95 13.533 8 13z"/></svg>
                <span class="hidden sm:block text-2xl font-semibold">Documentation</span>
            </a>
          </div>
            <div class="hidden sm:-my-px sm:ml-6 sm:flex sm:space-x-4 lg:space-x-8">
                <!-- Current: "border-indigo-500 text-gray-900", Default: "border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700" -->
                        <a href="/templates/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200">
                            <span class="hidden xl:inline mr-1">Project</span> Templates
                        </a>
                        <a href="/vue/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200">
                            Vue
                        </a>
                        <a href="/react/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200">
                            React
                        </a>
                        <a href="/autoquery/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200">
                            AutoQuery
                        </a>
                        <a href="/auth/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-indigo-500 text-gray-900">
                            Auth
                        </a>
                        <a href="/ormlite/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200">
                            OrmLite
                        </a>
                        <a href="/redis/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200">
                            Redis
                        </a>
                        <a href="/locode/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200 hidden lg:inline-flex">
                            Locode
                        </a>
                        <a href="/grpc/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200 hidden lg:inline-flex">
                            gRPC
                        </a>
            </div>
        </div>
        <div class="hidden sm:ml-6 sm:flex sm:items-center">
            <typesense></typesense>
            <dark-mode-toggle class="ml-2 w-10"></dark-mode-toggle>
        </div>
        <div class="-mr-2 flex items-center sm:hidden">
          <!-- Mobile menu button -->
          <button type="button" v-on:click="open=!open" class="inline-flex items-center justify-center rounded-md bg-white dark:bg-black p-2 text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:ring-offset-black" aria-controls="mobile-menu" aria-expanded="false">
            <span class="sr-only">Open main menu</span>
            <!-- Menu open: "hidden", Menu closed: "block" -->
            <svg :class="['h-6 w-6', open ? 'hidden' : 'block']" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
            <!-- Menu open: "block", Menu closed: "hidden" -->
            <svg :class="['h-6 w-6', open ? 'block' : 'hidden']" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile menu, show/hide based on menu state. -->
    <div v-cloak v-if="open" class="sm:hidden">
        <div class="space-y-1 pb-3 pt-2">
            <!-- Current: "border-indigo-500 bg-indigo-50 text-indigo-700", Default: "border-transparent text-gray-600 hover:border-gray-300 hover:bg-gray-50 hover:text-gray-800" -->
                    <a href="/templates/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        Project Templates
                    </a>
                    <a href="/vue/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        Vue
                    </a>
                    <a href="/react/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        React
                    </a>
                    <a href="/autoquery/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        AutoQuery
                    </a>
                    <a href="/auth/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-indigo-500 bg-indigo-50 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-200">
                        Auth
                    </a>
                    <a href="/ormlite/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        OrmLite
                    </a>
                    <a href="/redis/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        Redis
                    </a>
                    <a href="/locode/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        Locode
                    </a>
                    <a href="/grpc/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        gRPC
                    </a>
        </div>
    </div>
  </nav>
</header>

<script type="module">
import { ref } from "vue"
import { mount } from "app.mjs"

const Header = {
    setup() {
        const open = ref(false)
        return { open }
    }
}
mount('#header', Header)
</script>


<div class="min-h-screen">
    <main role="main" class="pt-16 pb-3 max-w-[100rem] mx-auto">
        



<style>
.active {
    color: #0ea5e9 !important;
}
</style>
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/typography.css">
<link rel="stylesheet" href="/css/lite-yt-embed.css">

<div class="w-full max-w-[100rem] mx-auto">
    <div class="flex flex-wrap">
        <div id="sidebar" class="z-40 inset-0 flex-none bg-white dark:bg-black lg:w-64 xl:w-80">
            <button v-cloak v-on:click="open=true" :class="['text-gray-400 hover:text-gray-500 pt-4 pl-2 absolute transform transition-all duration-200', open ? 'opacity-0 translate-x-56' : 'opacity-100']" title="Open Sidebar">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H10m10 0l-4 4m4-4l-4-4M4 4v16"/></svg>
            </button>
            <div :class="['fixed bg-white dark:bg-black h-screen overflow-y-auto scrolling-touch overflow-hidden shadow lg:shadow-none transform transition-transform duration-200', open ? '' : 'translate-x-[-100%]']">
                <nav class="sidebar lg:w-64 xl:w-80 px-1 pt-6 pb-16 overflow-y-auto font-medium text-sm lg:text-base sm:px-3 xl:px-5" aria-label="Sidebar">
                    <close-button title="Close Sidebar" class="lg:hidden -mr-2" v-on:close="open=false"></close-button>
                                <a href="/auth/" class="block flex items-center whitespace-nowrap">
<svg class='h-6 w-6 shrink-0 text-sky-500' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' aria-hidden='true'><path stroke-linecap='round' stroke-linejoin='round' d='M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25'></path></svg>                                    <span class="p-2 pl-3 font-display font-medium text-slate-900 dark:text-white">
Auth                                    </span>
                                </a>
                        <ul role="list" class="mb-6 mt-2 ml-3 space-y-2 border-l-2 border-slate-100 dark:border-slate-800 lg:mt-4 lg:space-y-4 lg:border-slate-200">
                                <li class="relative">
                                    <a href="/auth/client-auth" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Client Authentication
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/restricting-services" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Restricting Services
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/encrypted-messaging" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Encrypted Messaging
                                    </a>
                                </li>
                        </ul>
                                <h2 class="font-display font-medium text-slate-900 dark:text-white whitespace-nowrap">
                                    ASP.NET Core Identity Auth
                                </h2>
                        <ul role="list" class="mb-6 mt-2 ml-3 space-y-2 border-l-2 border-slate-100 dark:border-slate-800 lg:mt-4 lg:space-y-4 lg:border-slate-200">
                                <li class="relative">
                                    <a href="/auth/identity-auth" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Overview
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/jwt-identity-auth" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        JWT Identity Auth
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/apikeys" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        API Keys
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/admin-apikeys" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Simple Admin Auth with API Keys
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/migrate-to-identity-auth" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Migrate to Identity Auth
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/identityserver" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Using IdentityServer4 Auth
                                    </a>
                                </li>
                        </ul>
                                <h2 class="font-display font-medium text-slate-900 dark:text-white whitespace-nowrap">
                                    ServiceStack Auth
                                </h2>
                        <ul role="list" class="mb-6 mt-2 ml-3 space-y-2 border-l-2 border-slate-100 dark:border-slate-800 lg:mt-4 lg:space-y-4 lg:border-slate-200">
                                <li class="relative">
                                    <a href="/auth/authentication-and-authorization" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Overview
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/auth-repository" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full active font-semibold text-sky-500 before:bg-sky-500">
                                        Auth Repository
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/identity-servicestack" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Using ServiceStack Auth in MVC
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/sessions" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Sessions
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/jwt-authprovider" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        JWT AuthProvider
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/api-key-authprovider" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        API Key AuthProvider
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/signin-with-apple" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Sign in with Apple AuthProvider
                                    </a>
                                </li>
                                <li class="relative">
                                    <a href="/auth/anti-forgery" class="block w-full pl-3.5 before:pointer-events-none before:absolute before:-left-1 before:top-1/2 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300">
                                        Anti Forgery
                                    </a>
                                </li>
                        </ul>
                </nav>
            </div>
        </div>
        <div id="doc" class="mx-auto flex">
            <div class="mt-8 mx-auto prose lg:prose-lg">
                
                    <section class="not-prose mb-16 md:mb-12">
                        <h1 class="text-4xl tracking-tight font-extrabold text-gray-900 dark:text-gray-50 sm:text-5xl md:text-6xl">
                            Auth Repository
                        </h1>
                    </section>

                <div class="not-prose"></div>

                <div class="content"><p>ServiceStack Auth supports using your own persistence back-ends but for the most part you should be able to reuse one of the existing <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/Auth/IAuthRepository.cs">IAuthRepository</a>:</p>
<ul>
<li><strong>OrmLite</strong>: <code>OrmLiteAuthRepository</code> in <a href="https://nuget.org/packages/ServiceStack.Server">ServiceStack.Server</a>
<ul>
<li><a href="/multitenancy#multitenancy-rdbms-authprovider">OrmLiteAuthRepositoryMultitenancy</a></li>
</ul>
</li>
<li><strong>Redis</strong>: <code>RedisAuthRepository</code> in <a href="https://nuget.org/packages/ServiceStack">ServiceStack</a></li>
<li><strong>Memory</strong>: <code>InMemoryAuthRepository</code> in <a href="https://nuget.org/packages/ServiceStack">ServiceStack</a></li>
<li><strong>AWS DynamoDB</strong>: <code>DynamoDbAuthRepository</code> in <a href="https://nuget.org/packages/ServiceStack.Aws">ServiceStack.Aws</a></li>
<li><strong>Mongo DB</strong>: <code>MongoDBAuthRepository</code> in <a href="https://nuget.org/packages/ServiceStack.Authentication.MongoDB">ServiceStack.Authentication.MongoDB</a></li>
<li><strong>Raven DB</strong>: <code>RavenUserAuthRepository</code> in <a href="https://nuget.org/packages/ServiceStack.Authentication.RavenDB">ServiceStack.Authentication.RavenDB</a></li>
<li><strong>Marten</strong>: <code>MartenAuthRepository</code> in <a href="https://www.nuget.org/packages/ServiceStack.Authentication.Marten">ServiceStack.Authentication.Marten</a> - <a href="https://github.com/migajek/ServiceStack.Authentication.Marten">GitHub project</a></li>
<li><strong>LiteDB</strong>: <code>LiteDBAuthRepository</code> in <a href="https://github.com/CaveBirdLabs/ServiceStack.Authentication.LiteDB">ServiceStack.Authentication.LiteDB</a></li>
</ul>
<h4 id="registering-an-auth-repository">Registering an Auth Repository<a class="header-anchor" href="javascript:;" onclick="location.hash='#registering-an-auth-repository'" aria-label="Permalink">&ZeroWidthSpace;</a></h4>
<p>The <code>OrmLiteAuthRepository</code> is the most common Auth Repository which will let you persist User Info in any of the <a href="/ormlite/#ormlite-rdbms-providers">RDBMS's that OrmLite supports</a>. All Auth Repositories are registered by adding a <code>IAuthRepository</code> dependency in your IOC, e.g:</p>
<pre><code class="language-csharp">container.Register&lt;IDbConnectionFactory&gt;(c =&gt;
    new OrmLiteConnectionFactory(connectionString, SqlServer2012Dialect.Provider));

container.Register&lt;IAuthRepository&gt;(c =&gt;
    new OrmLiteAuthRepository(c.Resolve&lt;IDbConnectionFactory&gt;()));

container.Resolve&lt;IAuthRepository&gt;().InitSchema();
</code></pre>
<p>Calling <code>InitSchema()</code> will create the necessary RDBMS <code>UserAuth</code> and <code>UserAuthDetails</code> tables if they don't already exist. By default the Users Roles and Permissions are blobbed on the <code>UserAuth</code> table, but if preferred they can optionally be maintained in a separate <code>UserAuthRole</code> table with:</p>
<pre><code class="language-csharp">container.Register&lt;IAuthRepository&gt;(c =&gt;
    new OrmLiteAuthRepository(c.Resolve&lt;IDbConnectionFactory&gt;()) {
        UseDistinctRoleTables = true
    });
</code></pre>
<p>Like the <a href="/caching">caching providers</a> the <code>async</code> Auth Repositories makes use of this existing <code>IAuthRepository</code> registration which you can use in your Services to access either <code>IAuthRepositoryAsync</code> or <code>IAuthRepository</code> APIs above even for your own sync Auth Repos that only implement <code>IAuthRepository</code> as it will return a <code>IAuthRepositoryAsync</code> wrapper API in its place.</p>
<h3 id="auth-repository-admin-apis">Auth Repository Admin APIs<a class="header-anchor" href="javascript:;" onclick="location.hash='#auth-repository-admin-apis'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>If you're interested in implementing a User Management feature in your own Apps you may want to re-use the Admin APIs in the <a href="/admin-ui-users">User Admin Feature</a> which enable Service access to many User Auth Repository features.</p>
<h3 id="mix-in-auth-repository">Mix in Auth Repository<a class="header-anchor" href="javascript:;" onclick="location.hash='#mix-in-auth-repository'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>The easiest way to configure a User Auth Repository in your <a href="/modular-startup">Modular Startup</a> App that new ASP.NET Core templates support
is to <a href="/mix-tool#composable-features">mix them in</a>, e.g. you can configure to use an OrmLiteAuthRepository using SQL Server with:</p>
<div class="not-prose sh-copy cp flex cursor-pointer mb-3" onclick="copy(this)">
                <div class="flex-grow bg-gray-800">
                    <div class="pl-4 py-1 pb-1.5 align-middle whitespace-pre text-base text-gray-100"><p>x mix auth-db sqlserver</p>
</div>
                    </div>
                <div class="flex">
                    <div class="bg-green-600 text-white p-1.5 pb-0">
                        <svg class="copied w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        <svg class="nocopy w-6 h-6" title="copy" fill='none' stroke='white' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
                            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='1' d='M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2'></path>
                        </svg>
                    </div>
                </div>
            </div>
<p>You can view other Auth Repository &quot;mix ins&quot; available with:</p>
<div class="not-prose sh-copy cp flex cursor-pointer mb-3" onclick="copy(this)">
                <div class="flex-grow bg-gray-800">
                    <div class="pl-4 py-1 pb-1.5 align-middle whitespace-pre text-base text-gray-100"><p>x mix [auth]</p>
</div>
                    </div>
                <div class="flex">
                    <div class="bg-green-600 text-white p-1.5 pb-0">
                        <svg class="copied w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        <svg class="nocopy w-6 h-6" title="copy" fill='none' stroke='white' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
                            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='1' d='M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2'></path>
                        </svg>
                    </div>
                </div>
            </div>
<p>Which displays the current list of available Auth Repositories:</p>
<pre><code>Results matching tag [auth]:

   1. auth              Configure AuthFeature                        to: $HOST  by @ServiceStack [auth]
   2. auth-db           Use OrmLite Auth Repository (requires auth)  to: $HOST  by @ServiceStack [auth]
   3. auth-redis        Use Redis Auth Repository (requires auth)    to: $HOST  by @ServiceStack [auth]
   4. auth-memory       Use Memory Auth Repository (requires auth)   to: $HOST  by @ServiceStack [auth]
   5. auth-dynamodb     Use DynamoDB Auth Repository (requires auth) to: $HOST  by @ServiceStack [auth]
   6. auth-mongodb      Use MongoDB Auth Repository (requires auth)  to: $HOST  by @ServiceStack [auth]
   7. auth-ravendb      Use RavenDB Auth Repository (requires auth)  to: $HOST  by @ServiceStack [auth]
   8. auth-marten       Use Marten Auth Repository (requires auth)   to: $HOST  by @ServiceStack [auth]
   9. feature-authrepo  List and Search Users in an Auth Repo        to: $HOST  by @ServiceStack [feature,auth]
</code></pre>
<p>and search the available RDBMS's and NoSQL Data Stores:</p>
<div class="not-prose sh-copy cp flex cursor-pointer mb-3" onclick="copy(this)">
                <div class="flex-grow bg-gray-800">
                    <div class="pl-4 py-1 pb-1.5 align-middle whitespace-pre text-base text-gray-100"><p>x mix [db]</p>
</div>
                    </div>
                <div class="flex">
                    <div class="bg-green-600 text-white p-1.5 pb-0">
                        <svg class="copied w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        <svg class="nocopy w-6 h-6" title="copy" fill='none' stroke='white' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
                            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='1' d='M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2'></path>
                        </svg>
                    </div>
                </div>
            </div>
<p>That can be easily configured by a mix in:</p>
<pre><code>Results matching tag [db]:

   1. redis      Use ServiceStack.Redis            to: $HOST  by @ServiceStack  [db]
   2. sqlserver  Use OrmLite with SQL Server       to: $HOST  by @ServiceStack  [db]
   3. sqlite     Use OrmLite with SQLite           to: $HOST  by @ServiceStack  [db]
   4. postgres   Use OrmLite with PostgreSQL       to: $HOST  by @ServiceStack  [db]
   5. mysql      Use OrmLite with MySql            to: $HOST  by @ServiceStack  [db]
   6. oracle     Use OrmLite with Oracle           to: $HOST  by @ServiceStack  [db]
   7. firebird   Use OrmLite with Firebird         to: $HOST  by @ServiceStack  [db]
   8. dynamodb   Use AWS DynamoDB and PocoDynamo   to: $HOST  by @ServiceStack  [db]
   9. mongodb    Use MongoDB                       to: $HOST  by @ServiceStack  [db]
  10. ravendb    Use RavenDB                       to: $HOST  by @ServiceStack  [db]
  11. marten     Use Marten NoSQL with PostgreSQL  to: $HOST  by @ServiceStack  [db]
</code></pre>
<h3 id="sync-async-auth-repositories">Sync &amp; Async Auth Repositories<a class="header-anchor" href="javascript:;" onclick="location.hash='#sync-async-auth-repositories'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>All built-in ServiceStack Auth Repositories implement both <code>IUserAuthRepository</code> and <code>IUserAuthRepositoryAsync</code> which you can use inside ServiceStack Services with the <code>AuthRepositoryAsync</code> property, e.g:</p>
<pre><code class="language-csharp">//async
public async Task&lt;object&gt; Post(GetUserAuth request)
{
    var userAuth = await AuthRepositoryAsync.GetUserAuthByUserNameAsync(request.UserName);
    if (userAuth == null)
        throw HttpError.NotFound(request.UserName);
    return userAuth;
}

//sync
public object Post(GetUserAuth request)
{
    var userAuth = AuthRepository.GetUserAuthByUserName(request.UserName);
    if (userAuth == null)
        throw HttpError.NotFound(request.UserName);
    return userAuth;
}
</code></pre>
<p>Outside of ServiceStack you can access it from the AppHost <code>GetAuthRepositoryAsync()</code> or <code>GetAuthRepository()</code> APIs, e.g:</p>
<pre><code class="language-csharp">//async
var authRepo = HostContext.AppHost.GetAuthRepositoryAsync();
await using (authRepo as IAsyncDisposable)
{
    //...
}

//sync
var authRepo = HostContext.AppHost.GetAuthRepository();
using (authRepo as IDisposable)
{
    //...
}
</code></pre>
<h2 id="extending-userauth-tables">Extending UserAuth tables<a class="header-anchor" href="javascript:;" onclick="location.hash='#extending-userauth-tables'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>There are a number of different extensibility options for extending ServiceStack Authentication by linking to external tables with its <code>RefId</code> and <code>RefIdStr</code> fields or storing custom info in the <code>Meta</code> Dictionaries.</p>
<p>Most Auth Repositories like OrmLite also supports utilizing custom <code>UserAuth</code> tables with extended fields which can be configured using its generic Constructor, e.g:</p>
<pre><code class="language-csharp">public class MyUserAuth : UserAuth { .... }
public class MyUserAuthDetails : UserAuthDetails { .... }
</code></pre>
<pre><code class="language-csharp">container.Register&lt;IAuthRepository&gt;(c =&gt;
    new OrmLiteAuthRepository&lt;MyUserAuth, MyUserAuthDetails&gt;(c.Resolve&lt;IDbConnectionFactory&gt;()) {
        UseDistinctRoleTables = true
    });
</code></pre>
<p>The <a href="/mix-tool#mix-in-auth-repository">Auth Repository mix gists</a> are configured with an example using a custom <code>AppUser</code> table which are populated using the <a href="/auth/sessions#session-events">Session and Auth Events</a> hooks, e.g:</p>
<pre><code class="language-csharp">// Custom User Table with extended Metadata properties
public class AppUser : UserAuth
{
    public string ProfileUrl { get; set; }
    public string LastLoginIp { get; set; }
    public DateTime? LastLoginDate { get; set; }
}

public class AppUserAuthEvents : AuthEvents
{
    public override void OnAuthenticated(IRequest req, IAuthSession session, IServiceBase authService, 
        IAuthTokens tokens, Dictionary&lt;string, string&gt; authInfo)
    {
        var authRepo = HostContext.AppHost.GetAuthRepository(req);
        using (authRepo as IDisposable)
        {
            var userAuth = (AppUser)authRepo.GetUserAuth(session.UserAuthId);
            userAuth.ProfileUrl = session.GetProfileUrl();
            userAuth.LastLoginIp = req.UserHostAddress;
            userAuth.LastLoginDate = DateTime.UtcNow;
            authRepo.SaveUserAuth(userAuth);
        }
    }
}
</code></pre>
<h4 id="custom-userauth-tables">Custom UserAuth Tables<a class="header-anchor" href="javascript:;" onclick="location.hash='#custom-userauth-tables'" aria-label="Permalink">&ZeroWidthSpace;</a></h4>
<p>If you want to add support for custom <code>UserAuth</code> and <code>UserAuthDetails</code> tables in your own custom Auth Repositories you'll need to implement the
<code>ICustomUserAuth</code> interface by returning the concrete Type that should be used instead:</p>
<pre><code class="language-csharp">public interface ICustomUserAuth
{
    IUserAuth CreateUserAuth();
    IUserAuthDetails CreateUserAuthDetails();
}
</code></pre>
<p>If implementing a generic class like <code>OrmLiteAuthRepository&lt;TUserAuth,TUserAuthDetails&gt;</code> you can return new instances of the Generic Type Arguments with:</p>
<pre><code class="language-csharp">IUserAuth CreateUserAuth() =&gt; (IUserAuth)typeof(TUserAuth).CreateInstance();

IUserAuthDetails CreateUserAuthDetails() =&gt; (IUserAuthDetails)typeof(TUserAuthDetails).CreateInstance();
</code></pre>
<h3 id="adding-additional-metadata-to-the-meta-dictionary-fields">Adding additional metadata to the Meta dictionary fields<a class="header-anchor" href="javascript:;" onclick="location.hash='#adding-additional-metadata-to-the-meta-dictionary-fields'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>For minor extensions you can use the <strong>Meta</strong> string dictionaries fields on the UserAuth tables to maintain custom metadata.
They include useful <code>Get&lt;T&gt;</code> and <code>Set&lt;T&gt;</code> methods which can be used to blob additional complex types with each User, e.g:</p>
<pre><code class="language-csharp">userAuth.Set(new Address { ... });
var address = userAuth.Get&lt;Address&gt;();
</code></pre>
<h3 id="linking-referential-data-with-refid-and-refidstr-fields">Linking referential data with RefId and RefIdStr fields<a class="header-anchor" href="javascript:;" onclick="location.hash='#linking-referential-data-with-refid-and-refidstr-fields'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>The <code>UserAuth</code> and <code>UserAuthDetails</code> tables also include an <code>int? RefId</code> and a <code>string RefIdStr</code> fields which you can use to reference external data like your own custom tables against each User Auth record or User OAuth registration.</p>
<h3 id="extend-userauthsession-with-your-own-typed-custom-session">Extend UserAuthSession with your own typed Custom Session<a class="header-anchor" href="javascript:;" onclick="location.hash='#extend-userauthsession-with-your-own-typed-custom-session'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>In addition to a Custom UserAuth tables you can also use a custom <code>AuthUserSession</code> for maintaining typed Users Sessions which get blobbed in a fast <a href="/caching">Caching Provider</a> where its schema-less persistance characteristics, easily supports fast access to extended types.</p>
<pre><code class="language-csharp">public class CustomUserSession : AuthUserSession { ... }

appHost.Plugins.Add(new AuthFeature(
    () =&gt; new CustomUserSession(), ...);
</code></pre>
<h3 id="iauthrepository-apis">IAuthRepository APIs<a class="header-anchor" href="javascript:;" onclick="location.hash='#iauthrepository-apis'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>Inside your Services you can access the <strong>async</strong> <code>base.AuthRepositoryAsync</code> and <strong>sync</strong> <code>IAuthRepository</code> APIs with:</p>
<pre><code class="language-csharp">await base.AuthRepositoryAsync.CreateUserAuthAsync(...);
</code></pre>
<p>You can use the Async APIs with every Auth Repository as an async wrapper is returned for Auth Repositories which only support the Sync APIs.</p>
<p>If you need to access the Auth Repository from inside a sync method you can access the <strong>sync</strong> APIs from <code>base.AuthRepository</code>, e.g:</p>
<pre><code class="language-csharp">base.AuthRepository.CreateUserAuth(...);
</code></pre>
<p>All ServiceStack's built-in Auth Repositories support the extended <code>IUserAuthRepository</code> APIs which your Services can use to manage your App's registered users:</p>
<pre><code class="language-csharp">public interface IUserAuthRepository : IAuthRepository
{
    IUserAuth CreateUserAuth(IUserAuth newUser, string password);
    IUserAuth UpdateUserAuth(IUserAuth existingUser, IUserAuth newUser);
    IUserAuth UpdateUserAuth(IUserAuth existingUser, IUserAuth newUser, string password);
    IUserAuth GetUserAuth(string userAuthId);
    void DeleteUserAuth(string userAuthId);
}

public interface IUserAuthRepositoryAsync : IAuthRepositoryAsync
{
    Task&lt;IUserAuth&gt; CreateUserAuthAsync(IUserAuth newUser, string password, CancellationToken token);
    Task&lt;IUserAuth&gt; UpdateUserAuthAsync(IUserAuth existingUser, IUserAuth newUser, CancellationToken token);
    Task&lt;IUserAuth&gt; UpdateUserAuthAsync(IUserAuth existingUser, IUserAuth newUser, string password);
    Task&lt;IUserAuth&gt; GetUserAuthAsync(string userAuthId, CancellationToken token);
    Task DeleteUserAuthAsync(string userAuthId, CancellationToken token);
}

public interface IAuthRepository
{
    void LoadUserAuth(IAuthSession session, IAuthTokens tokens);
    void SaveUserAuth(IAuthSession authSession);
    List&lt;IUserAuthDetails&gt; GetUserAuthDetails(string userAuthId);
    IUserAuthDetails CreateOrMergeAuthSession(IAuthSession authSession, IAuthTokens tokens);

    IUserAuth GetUserAuth(IAuthSession authSession, IAuthTokens tokens);
    IUserAuth GetUserAuthByUserName(string userNameOrEmail);
    void SaveUserAuth(IUserAuth userAuth);
    bool TryAuthenticate(string userName, string password, out IUserAuth userAuth);
    bool TryAuthenticate(Dictionary&lt;string, string&gt; digestHeaders, 
        string privateKey, int nonceTimeOut, string sequence, out IUserAuth userAuth);
}

public interface IAuthRepositoryAsync
{
    Task LoadUserAuthAsync(IAuthSession session, IAuthTokens tokens, CancellationToken token);
    Task SaveUserAuthAsync(IAuthSession authSession, CancellationToken token);
    Task&lt;List&lt;IUserAuthDetails&gt;&gt; GetUserAuthDetailsAsync(string userAuthId, CancellationToken token);
    Task&lt;IUserAuthDetails&gt; CreateOrMergeAuthSessionAsync(IAuthSession authSession, IAuthTokens tokens);

    Task&lt;IUserAuth&gt; GetUserAuthAsync(IAuthSession authSession, IAuthTokens tokens, CancellationToken token);
    Task&lt;IUserAuth&gt; GetUserAuthByUserNameAsync(string userNameOrEmail, CancellationToken token);
    Task SaveUserAuthAsync(IUserAuth userAuth, CancellationToken token);
    Task&lt;IUserAuth&gt; TryAuthenticateAsync(string userName, string password, CancellationToken token);
    Task&lt;IUserAuth&gt; TryAuthenticateAsync(Dictionary&lt;string, string&gt; digestHeaders, 
        string privateKey, int nonceTimeOut, string sequence, CancellationToken token);
}
</code></pre>
<h3 id="updating-userauth-tables-directly">Updating UserAuth tables directly<a class="header-anchor" href="javascript:;" onclick="location.hash='#updating-userauth-tables-directly'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>If you need finer-grained access than the shared APIs above, you can update the <code>UserAuth</code> and <code>UserAuthDetails</code> POCOs
in your preferred persistence provider directly.</p>
<p>E.g. if you're using the <code>OrmLiteAuthRepository</code> to store your Users in an RDBMS back-end you can use
<a href="https://github.com/ServiceStack/ServiceStack.OrmLite">OrmLite APIs</a> to update the user details stored in the <code>UserAuth</code> and <code>UserAuthDetails</code>
tables, e.g:</p>
<pre><code class="language-csharp">Db.UpdateOnly(() =&gt; new UserAuth { DisplayName = newName }, where: q =&gt; q.Id == userId);
</code></pre>
<p>Which will only update the <code>DisplayName</code> column for the specified user.</p>
<p>If you're using a <a href="/auth/auth-repository#extending-userauth-tables">Custom UserAuth Table</a> (e.g. <code>AppUser</code>) instead of the default <code>UserAuth</code> you would need to update that POCO data model instead.</p>
<h3 id="imanageroles-api">IManageRoles API<a class="header-anchor" href="javascript:;" onclick="location.hash='#imanageroles-api'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>The <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/Auth/IAuthRepository.cs#L72">IManageRoles API</a>
can be implemented by any <code>IAuthRepository</code> to provide an alternative strategy for querying and managing Users Roles and permissions.</p>
<p>This API is being used in the <code>OrmLiteAuthRepository</code> to provide an alternative way to store Roles and Permission in their own distinct table rather than being blobbed with the rest of the User Auth data.</p>
<p>This behavior can be enabled in <code>OrmLiteAuthRepository</code> by specifying <code>UseDistinctRoleTables=true</code> at registration, e.g:</p>
<pre><code class="language-csharp">container.Register&lt;IAuthRepository&gt;(c =&gt;
    new OrmLiteAuthRepository(c.Resolve&lt;IDbConnectionFactory&gt;()) {
        UseDistinctRoleTables = true,
    });
</code></pre>
<p>When enabled, roles and permissions are persisted in the distinct <strong>UserAuthRole</strong> table instead of being blobbed on the UserAuth. The <code>IAuthSession.HasRole()</code> and <code>IAuthSession.HasPermission()</code> on the Users Session should be used to check if a User has a specified Role or Permission.</p>
<p>If you're persisting roles in a different table you'll need to use the <code>IManageRoles</code> APIs to access &amp; manage a users role, e.g:</p>
<pre><code class="language-csharp">var manageRoles = (IManageRolesAsync)base.AuthRepositoryAsync;  // async
var manageRoles = (IManageRoles)base.AuthRepository;            // sync
</code></pre>
<p>These APIs can be used with <code>OrmLiteAuthRepository</code> whether Roles are persisted in external tables or not.</p>
<pre><code class="language-csharp">public interface IManageRoles
{
    ICollection&lt;string&gt; GetRoles(string userAuthId);
    ICollection&lt;string&gt; GetPermissions(string userAuthId);
    void GetRolesAndPermissions(string userAuthId, out ICollection&lt;string&gt; roles, 
        out ICollection&lt;string&gt; permissions);

    bool HasRole(string userAuthId, string role);
    bool HasPermission(string userAuthId, string permission);

    void AssignRoles(string userAuthId,
        ICollection&lt;string&gt; roles = null, ICollection&lt;string&gt; permissions = null);

    void UnAssignRoles(string userAuthId,
        ICollection&lt;string&gt; roles = null, ICollection&lt;string&gt; permissions = null);
}

public interface IManageRolesAsync
{
    Task&lt;ICollection&lt;string&gt;&gt; GetRolesAsync(string userAuthId, CancellationToken token);
    Task&lt;ICollection&lt;string&gt;&gt; GetPermissionsAsync(string userAuthId, CancellationToken token);
    Task&lt;Tuple&lt;ICollection&lt;string&gt;,ICollection&lt;string&gt;&gt;&gt; GetRolesAndPermissionsAsync(
        string userAuthId, CancellationToken token);

    Task&lt;bool&gt; HasRoleAsync(string userAuthId, string role, CancellationToken token);
    Task&lt;bool&gt; HasPermissionAsync(string userAuthId, string permission, CancellationToken token);

    Task AssignRolesAsync(string userAuthId,
        ICollection&lt;string&gt; roles = null, ICollection&lt;string&gt; permissions = null, CancellationToken token);

    Task UnAssignRolesAsync(string userAuthId,
        ICollection&lt;string&gt; roles = null, ICollection&lt;string&gt; permissions = null, CancellationToken token);
}
</code></pre>
<p>More examples of this are in <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.Common.Tests/ManageRolesTests.cs">ManageRolesTests.cs</a>.</p>
<h3 id="assigning-roles-and-permissions">Assigning Roles and Permissions<a class="header-anchor" href="javascript:;" onclick="location.hash='#assigning-roles-and-permissions'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>Super Users with the <strong>Admin</strong> role or Requests with an <a href="/debugging#authsecret">AdminAuthSecret</a> can call the built-in <code>/assignroles</code> and <code>/unassignroles</code> Services to add Roles/Permissions to existing users from an external Request, e.g:</p>
<pre><code class="language-csharp">var client = new JsonApiClient(baseUrl);
var response = client.Post(new AssignRoles
{
    UserName = userName,
    Roles = new List&lt;string&gt; { &quot;TheRole&quot; },
    Permissions = new List&lt;string&gt; { &quot;ThePermission&quot; }
});
</code></pre>
<p>Inside ServiceStack you can use the <code>AssignRoles</code> API to add Roles and Permissions to an existing User:</p>
<pre><code class="language-csharp">var userAuth = await AuthRepositoryAsync.GetUserAuthByUserNameAsync(userName);
if (userAuth == null)
    throw HttpError.NotFound(userName);

await AuthRepositoryAsync.AssignRolesAsync(userAuth, new[]{ &quot;TheRole&quot; }, new[]{ &quot;ThePermission&quot; });
</code></pre>
<p>Alternatively you can add Roles when creating a new User with:</p>
<pre><code class="language-csharp">await AssignRolesAsync.CreateUserAuthAsync(new UserAuth
{
    UserName = userName,
    FirstName = &quot;John&quot;,
    LastName = &quot;Doe&quot;,
    DisplayName = &quot;John Doe&quot;,
    Roles = new List&lt;string&gt; { &quot;TheRole&quot; }
}, userPassword);
</code></pre>
<h3 id="customizing-user-roles-and-permissions">Customizing User Roles and Permissions<a class="header-anchor" href="javascript:;" onclick="location.hash='#customizing-user-roles-and-permissions'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>The default implementation of User Roles and Permissions on <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/AuthUserSession.cs">AuthUserSession</a> shows how ServiceStack's <code>[RequiredRole]</code> and <code>[RequiredPermission]</code> <a href="/auth/authentication-and-authorization#the-requiredrole-and-requiredpermission-attributes">Roles and Permission attributes</a> are validated:</p>
<pre><code class="language-csharp">public virtual bool HasPermission(string permission)
{
    var managesRoles = HostContext.TryResolve&lt;IAuthRepository&gt;() as IManageRoles;
    if (managesRoles != null)
    {
        return managesRoles.HasPermission(this.UserAuthId, permission);
    }

    return this.Permissions != null &amp;&amp; this.Permissions.Contains(permission);
}

public virtual bool HasRole(string role)
{
    var managesRoles = HostContext.TryResolve&lt;IAuthRepository&gt;() as IManageRoles;
    if (managesRoles != null)
    {
        return managesRoles.HasRole(this.UserAuthId, role);
    }

    return this.Roles != null &amp;&amp; this.Roles.Contains(role);
}
</code></pre>
<p>These APIs are <code>virtual</code> so they can be overridden in both your Custom <code>AuthUserSession</code>. They default to looking at the <code>Roles</code> and <code>Permissions</code> collections stored on the Session. These collections are normally sourced from the <code>AuthUserRepository</code> when persisting the <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/Auth/UserAuth.cs">UserAuth and UserAuthDetails POCO's</a> and are used to populate the <code>UserAuthSession</code> on successful Authentication. These collections can be further customized by AuthProviders which is what <code>AspNetWindowsAuthProvider</code> does to add <a href="https://github.com/ServiceStack/ServiceStack/blob/9773b7fccc31ac4d715a02221f396b46cd14d7db/src/ServiceStack/Auth/AspNetWindowsAuthProvider.cs#L126">Authenticated WindowsAuth Roles</a>.</p>
<p>As seen above Roles/Permissions can instead be managed by AuthProviders that implement <code>IManageRoles</code> API which is what OrmLiteAuthProvider uses to look at distinct RDBMS tables to validate Roles/Permissions.</p>
<h3 id="microsoft-graph-roles">Microsoft Graph Roles<a class="header-anchor" href="javascript:;" onclick="location.hash='#microsoft-graph-roles'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p><a href="/auth#auth-providers">OAuth Providers</a> like Microsoft Graph have their own global roles for users managed separately. In order to combine both Microsoft Graph's Azure AD Roles with App-defined roles when using the <code>OrmLiteAuthRepository</code> it needs to be configured to persist roles in distinct role tables (required to capture the source of each role):</p>
<pre><code class="language-csharp">services.AddSingleton&lt;IAuthRepository&gt;(c =&gt;
    new OrmLiteAuthRepository&lt;AppUser, UserAuthDetails&gt;(c.Resolve&lt;IDbConnectionFactory&gt;()) {
        UseDistinctRoleTables = true
    });
</code></pre>
<p>Once configured you'll be able to manage your App's local User roles via ServiceStack's <a href="/auth/auth-repository">Auth Repository</a>, <a href="/auth/auth-repository#assigning-roles-and-permissions">Assign Roles APIs</a> or built-in <a href="/admin-ui-users">Admin Users UI</a> without interfering with Azure AD managed roles:</p>
<div class="block flex justify-center items-center">
    <a href="/admin-ui-users"><img class="max-w-screen-md" src="/img/pages/admin-ui/users-edit-default.png"></a>
</div>
<h3 id="pbkdf2-password-hashing-implementation">PBKDF2 Password Hashing implementation<a class="header-anchor" href="javascript:;" onclick="location.hash='#pbkdf2-password-hashing-implementation'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>ServiceStack uses the same <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> password hashing algorithm ASP.NET Identity v3 by default for both new users and successful authentication logins where their password will automatically be re-hashed with the new implementation.</p>
<p>This also means if you wanted to switch, you'll be able to import ASP.NET Identity v3 User Accounts and their Password Hashes into ServiceStack.Auth's <code>UserAuth</code> tables and vice-versa.</p>
<h4 id="retain-previous-password-hashing-implementation">Retain previous Password Hashing implementation<a class="header-anchor" href="javascript:;" onclick="location.hash='#retain-previous-password-hashing-implementation'" aria-label="Permalink">&ZeroWidthSpace;</a></h4>
<p>If preferred you can revert to using the existing <code>SaltedHash</code> implementation with:</p>
<pre><code class="language-csharp">SetConfig(new HostConfig { 
    UseSaltedHash = true
});
</code></pre>
<p>This also supports &quot;downgrading&quot; passwords that were hashed with the new <code>IPasswordHasher</code> provider where it will revert to using the older/weaker <code>SaltedHash</code> implementation on successful authentication.</p>
<h4 id="override-password-hashing-strength">Override Password Hashing Strength<a class="header-anchor" href="javascript:;" onclick="location.hash='#override-password-hashing-strength'" aria-label="Permalink">&ZeroWidthSpace;</a></h4>
<p>The new <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/Auth/PasswordHasher.cs">PasswordHasher</a> implementation can also be made to be computationally stronger or weaker by adjusting the iteration count (default 10000), e.g:</p>
<pre><code class="language-csharp">container.Register&lt;IPasswordHasher&gt;(new PasswordHasher(1000));
</code></pre>
<h4 id="versionable-password-hashing">Versionable Password Hashing<a class="header-anchor" href="javascript:;" onclick="location.hash='#versionable-password-hashing'" aria-label="Permalink">&ZeroWidthSpace;</a></h4>
<p>The new <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Auth/IPasswordHasher.cs">IPasswordHasher</a> interface includes support for versioning future Password Hashing algorithms and rehashing:</p>
<pre><code class="language-csharp">public interface IPasswordHasher
{
    // First byte marker used to specify the format used. The default implementation uses format:
    // { 0x01, prf (UInt32), iter count (UInt32), salt length (UInt32), salt, subkey }
    byte Version { get; }

    // Returns a boolean indicating whether the providedPassword matches the hashedPassword
    // The needsRehash out parameter indicates whether the password should be re-hashed.
    bool VerifyPassword(string hashedPassword, string providedPassword, out bool needsRehash);

    // Returns a hashed representation of the supplied password
    string HashPassword(string password);
}
</code></pre>
<p>Which is implemented in all ServiceStack Auth Repositories where it will rehash passwords that used a different version or weaker strength, by utilizing the new API for verifying passwords:</p>
<pre><code class="language-csharp">if (userAuth.VerifyPassword(password, out var needsRehash))
{
    this.RecordSuccessfulLogin(userAuth, needsRehash, password);
    return true;
}
</code></pre>
<p>If you're using a Custom Auth Repository it will need to use the new password verification APIs, please refer to <a href="https://github.com/ServiceStack/ServiceStack/blob/bed1d900de93f889cca05299df4c33a04b7ad7a7/src/ServiceStack.Server/Auth/OrmLiteAuthRepository.cs#L325-L359">OrmLiteAuthRepository</a> for a complete concrete example.</p>
<h4 id="fallback-passwordhashers">Fallback PasswordHashers<a class="header-anchor" href="javascript:;" onclick="location.hash='#fallback-passwordhashers'" aria-label="Permalink">&ZeroWidthSpace;</a></h4>
<p>The list of <code>Config.FallbackPasswordHashers</code> can be used for migrating to a new Password Hashing algorithm by registering older Password Hashing implementations that were previously used to hash Users passwords. Failed password verifications will fallback to see if the password was hashed with any of the registered <code>FallbackPasswordHashers</code>, if any are valid, the password attempt will succeed and the password re-hashed with the registered <code>IPasswordHasher</code> implementation.</p>
<h3 id="digest-auth-hashes-only-created-when-needed">Digest Auth Hashes only created when needed<a class="header-anchor" href="javascript:;" onclick="location.hash='#digest-auth-hashes-only-created-when-needed'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>Digest Auth Hashes are only populated if the <code>DigestAuthProvider</code> is registered. If you ever intend to support Digest access authentication in future but don't want to register the DigestAuthProvider just yet, you can force ServiceStack to continue to maintain Digest Auth Hashes with:</p>
<pre><code class="language-csharp">new AuthFeature {
    CreateDigestAuthHashes = true
}
</code></pre>
<p>Users that don't have Digest Auth Hashes will require logging in again in order to have it populated. If you don't intend to use Digest Auth you can clear the <code>DigestHa1Hash</code> column in your <code>UserAuth</code> table which is otherwise unused.</p>
</div>

                <div class="not-prose"></div>
                
                    <div class="not-prose py-8">
                        <a class="text-slate-500 font-semibold hover:text-indigo-600 flex items-center" href="https://github.com/ServiceStack/docs.servicestack.net/blob/main/MyApp/_pages/auth/auth-repository.md" target="_blank" rel="noopener noreferrer">
                            Edit this page on GitHub<svg class="ml-1 inline-block w-4 h-4" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" data-v-1ed99556=""><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg>
                        </a>
                    </div>

                    <div class="not-prose my-20">
                                <nav class="flex items-center justify-between border-t border-gray-200 dark:border-gray-700 px-4 sm:px-0">
                                    <div class="-mt-px flex w-0 flex-1">
                                            <a href="/auth/authentication-and-authorization" class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-gray-500 hover:border-gray-300 dark:hover:border-gray-600 hover:text-gray-700 dark:hover:text-gray-200">
                                                <!-- Heroicon name: mini/arrow-long-left -->
                                                <svg class="mr-3 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                    <path fill-rule="evenodd" d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z" clip-rule="evenodd"></path>
                                                </svg>
                                                Overview
                                            </a>
                                    </div>
                                    <div class="hidden md:-mt-px md:flex"></div>
                                    <div class="-mt-px flex w-0 flex-1 justify-end">
                                            <a href="/auth/identity-servicestack" class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-gray-500 hover:border-gray-300 dark:hover:border-gray-600 hover:text-gray-700 dark:hover:text-gray-200">
                                                Using ServiceStack Auth in MVC
                                                <!-- Heroicon name: mini/arrow-long-right -->
                                                <svg class="ml-3 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                    <path fill-rule="evenodd" d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z" clip-rule="evenodd"></path>
                                                </svg>
                                            </a>
                                    </div>
                                </nav>
                    </div>
            </div>
                
                <div class="docmap hidden 2xl:block flex-none w-64 pl-8 mr-8">
                    <div class="fixed bg-white dark:bg-black flex flex-col overflow-y-auto pt-10 px-8 pb-6" style="height:calc(100vh - 50px);">
                        <div>
                            <h5 class="text-slate-900 font-semibold mb-4 text-sm leading-6 dark:text-slate-100">
                                On This Page
                            </h5>
                            <ul class="text-slate-700 text-sm leading-6">
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#extending-userauth-tables'" data-id="extending-userauth-tables" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Extending UserAuth tables
                                        </span>
                                            <ul class="ml-4">
                                                    <li data-id="adding-additional-metadata-to-the-meta-dictionary-fields" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#adding-additional-metadata-to-the-meta-dictionary-fields'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            Adding additional metadata to the Meta dictionary fields
                                                        </span>
                                                    </li>
                                                    <li data-id="linking-referential-data-with-refid-and-refidstr-fields" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#linking-referential-data-with-refid-and-refidstr-fields'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            Linking referential data with RefId and RefIdStr fields
                                                        </span>
                                                    </li>
                                                    <li data-id="extend-userauthsession-with-your-own-typed-custom-session" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#extend-userauthsession-with-your-own-typed-custom-session'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            Extend UserAuthSession with your own typed Custom Session
                                                        </span>
                                                    </li>
                                                    <li data-id="iauthrepository-apis" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#iauthrepository-apis'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            IAuthRepository APIs
                                                        </span>
                                                    </li>
                                                    <li data-id="updating-userauth-tables-directly" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#updating-userauth-tables-directly'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            Updating UserAuth tables directly
                                                        </span>
                                                    </li>
                                                    <li data-id="imanageroles-api" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#imanageroles-api'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            IManageRoles API
                                                        </span>
                                                    </li>
                                                    <li data-id="assigning-roles-and-permissions" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#assigning-roles-and-permissions'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            Assigning Roles and Permissions
                                                        </span>
                                                    </li>
                                                    <li data-id="customizing-user-roles-and-permissions" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#customizing-user-roles-and-permissions'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            Customizing User Roles and Permissions
                                                        </span>
                                                    </li>
                                                    <li data-id="microsoft-graph-roles" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#microsoft-graph-roles'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            Microsoft Graph Roles
                                                        </span>
                                                    </li>
                                                    <li data-id="pbkdf2-password-hashing-implementation" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#pbkdf2-password-hashing-implementation'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            PBKDF2 Password Hashing implementation
                                                        </span>
                                                    </li>
                                                    <li data-id="digest-auth-hashes-only-created-when-needed" class="text-gray-500 hover:text-gray-900">
                                                        <span v-hash="'#digest-auth-hashes-only-created-when-needed'" class="cursor-pointer flex text-sm transform transition-colors duration-200 py-2">
                                                            <svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 overflow-visible"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
                                                            Digest Auth Hashes only created when needed
                                                        </span>
                                                    </li>
                                            </ul>
                                    </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
        </div>
    </div>    
</div>

<script>
//doc instructions
if (document.querySelector('.hide-title')) {
    const el = document.querySelector('#doc section h1') 
    if (el) el.style.display='none'
}
</script>


<script type="module">
import { ref } from "vue"
import { mount } from "app.mjs"


    const App = {
        setup() {
            function nav(url) {
                window.open(url)
            }
            return { nav }
        }
    }
    
const Sidebar = {
    setup() {
        const open = ref(true)
        return { open }
    }
}

mount('#doc', App)
mount('#sidebar', Sidebar)
</script>

<script src="/lib/js/highlight.js"></script>
<script>hljs.highlightAll()</script>
<script src="/lib/js/lite-yt-embed.js"></script>
<script src="/mjs/docs.mjs" type="module"></script>


    </main>
</div>

<script type="module">
import { init } from "app.mjs"
init()
</script>





</body>
</html>